{
    "activations": [
        {
            "id": "$setup_constants",
            "execute": "$setup_constants"
        },
        {
            "id": "$initialise_machine",
            "execute": "$initialise_machine",
            "activating" : "Any_Action"
        },
        {
            "id": "Any_Action",
            "chooseActivation": {
                "RS_Action": 0.34,
                "IS_Action": 0.33,
                "IL_Action": 0.33
            }
        },
            {
                "id": "RS_Action",
                "chooseActivation": {
                    "RS_trainArrivalRequest": 0.1,
                    "RS_trainMoveFront": 0.8,
                    "RS_trainChangeState": 0.1
                }
            },
                {
                    "id": "RS_trainArrivalRequest",
                    "chooseActivation": {
                        "RS_trainArrivalRequest_Exec": "IF ENABLED(\"RS_trainArrivalRequest\") = TRUE THEN 1.0 ELSE 0.0 END",
                        "skip": "1.0 - IF ENABLED(\"RS_trainArrivalRequest\") = TRUE THEN 1.0 ELSE 0.0 END"
                    }
                },
                    {
                        "id": "RS_trainArrivalRequest_Exec",
                        "execute": "RS_trainArrivalRequest",
                        "activating": ["skip", "RS_trainArrivalRequest_Choose"]
                    },
                        {
                            "id": "RS_trainArrivalRequest_Choose",
                            "chooseActivation": {
                                "IL_trainAcceptArrival_Choose": 0.95,
                                "IL_trainDeclineArrival": 0.05
                            }
                        },
                            {
                                "id": "IL_trainAcceptArrival_Choose",
                                "chooseActivation": {
                                    "IL_trainAcceptArrival": "IF RS_requestingArrivalTrains /= {} & #route.(route : allIdsOfType(\"route\") & ENABLED_TRANSITION(FORMAT_TO_STRING(\"IL_startRouteReservation(\\\"~w\\\",\\\"~w\\\")\", [route, TO_STRING(CHOOSE(dom(RS_requestingArrivalTrains)))])) = TRUE) THEN 1.0 ELSE 0.0 END",
                                    "IL_trainAcceptArrival_Exec": "1.0 - IF RS_requestingArrivalTrains /= {} & #route.(route : allIdsOfType(\"route\") & ENABLED_TRANSITION(FORMAT_TO_STRING(\"IL_startRouteReservation(\\\"~w\\\",\\\"~w\\\")\", [route, TO_STRING(CHOOSE(dom(RS_requestingArrivalTrains)))])) = TRUE) THEN 1.0 ELSE 0.0 END"
                                }
                            },
                                {
                                    "id": "IL_trainAcceptArrival",
                                    "after": 1000,
                                    "execute": "IL_startRouteReservation",
                                    "additionalGuards": "RS_requestingArrivalTrains /= {}",
                                    "fixedVariables":{
                                        "Train": "CHOOSE(dom(RS_requestingArrivalTrains))"
                                    },
                                    "activating": ["IL_startActivateSignalplan", "IL_endRouteReservation"],
                                    "comment": "IL_trainAcceptArrival_Exec activated after end of route reservation"
                                },
                                    {
                                        "id": "IL_trainAcceptArrival_Exec",
                                        "after": 1000,
                                        "execute": "IL_trainAcceptArrival"
                                    },
                            {
                                "id": "IL_trainDeclineArrival",
                                "after": 1000,
                                "execute": "IL_trainDeclineArrival"
                            },
                {
                    "id": "RS_trainMoveFront",
                    "chooseActivation":{
                        "RS_trainMoveFront_Exec": "IF ENABLED(\"RS_trainMoveFront\") = TRUE THEN 1.0 ELSE 0.0 END",
                        "skip": "1.0 - IF ENABLED(\"RS_trainMoveFront\") = TRUE THEN 1.0 ELSE 0.0 END"
                    }
                },
                    {
                        "id": "RS_trainMoveFront_Exec",
                        "execute": "RS_trainMoveFront",
                        "activating" : ["skip", "RS_trainMoveBack"]
                    },
                        {
                            "id": "RS_trainMoveBack",
                            "after": 2000,
                            "execute": "RS_trainMoveBack",
                            "activating" : "RS_trainLeave"
                        },
                            {
                                "id": "RS_trainLeave",
                                "after": 1000,
                                "execute": "RS_trainLeave"
                            },
                {
                    "id": "RS_trainChangeState",
                    "chooseActivation":{
                        "RS_trainChangeState_Exec": "IF ENABLED(\"RS_trainChangeState\") = TRUE THEN 1.0 ELSE 0.0 END",
                        "skip": "1.0 - IF ENABLED(\"RS_trainChangeState\") = TRUE THEN 1.0 ELSE 0.0 END"
                    },
                    "comment": "TODO: Train on berthingTrack"
                },
                    {
                        "id": "RS_trainChangeState_Exec",
                        "after": 1000,
                        "execute": "RS_trainChangeState",
                        "activating" : ["skip", "RS_trainChangeDirection"]
                    },
                        {
                            "id": "RS_trainChangeDirection",
                            "after": 1000,
                            "execute": "RS_trainChangeDirection"
                        },

            {
                "id": "IS_Action",
                "chooseActivation": {
                    "IS_startChangeCrossing": 0.25,
                    "IS_startChangeDerailer": 0.25,
                    "IS_startChangeSwitch": 0.5
                },
                "comment": "TODO: IS_startChangeCoupledSwitches"
            },
            {
                "id": "IS_startChangeCrossing",
                    "chooseActivation": {
                        "IS_startChangeCrossing_Exec": "IF {CrossingId, train | train : RS_arrivedTrains & RS_trainFront(train) : dom(RailML3_IS_CROSSING_BRANCHES(CrossingId)) or #route.(route : dom(IL_routes_in_res) /\\ dom(RailML3_IL_ROUTE_CROSSING_POSITIONS) & CrossingId : dom(RailML3_IL_ROUTE_CROSSING_POSITIONS(route)) & IS_crossing_states(CrossingId) /= RailML3_IL_ROUTE_CROSSING_POSITIONS(route)(CrossingId)) } /= {} THEN 1.0 ELSE 0.0 END",
                        "skip": "1.0 - IF {CrossingId, train | train : RS_arrivedTrains & RS_trainFront(train) : dom(RailML3_IS_CROSSING_BRANCHES(CrossingId)) or #route.(route : dom(IL_routes_in_res) /\\ dom(RailML3_IL_ROUTE_CROSSING_POSITIONS) & CrossingId : dom(RailML3_IL_ROUTE_CROSSING_POSITIONS(route)) & IS_crossing_states(CrossingId) /= RailML3_IL_ROUTE_CROSSING_POSITIONS(route)(CrossingId)) } /= {} THEN 1.0 ELSE 0.0 END"
                    }
                },
                    {
                        "id": "IS_startChangeCrossing_Exec",
                        "execute": "IS_startChangeCrossing",
                        "after": 1000,
                        "additionalGuards": "{CrossingId, train | train : RS_arrivedTrains & RS_trainFront(train) : dom(RailML3_IS_CROSSING_BRANCHES(CrossingId)) or #route.(route : dom(IL_routes_in_res) /\\ dom(RailML3_IL_ROUTE_CROSSING_POSITIONS) & CrossingId : dom(RailML3_IL_ROUTE_CROSSING_POSITIONS(route)) & IS_crossing_states(CrossingId) /= RailML3_IL_ROUTE_CROSSING_POSITIONS(route)(CrossingId)) } /= {}",
                        "fixedVariables":{
                            "CrossingId": "CHOOSE(dom({CrossingId, train | train : RS_arrivedTrains & RS_trainFront(train) : dom(RailML3_IS_CROSSING_BRANCHES(CrossingId)) or #route.(route : dom(IL_routes_in_res) /\\ dom(RailML3_IL_ROUTE_CROSSING_POSITIONS) & CrossingId : dom(RailML3_IL_ROUTE_CROSSING_POSITIONS(route)) & IS_crossing_states(CrossingId) /= RailML3_IL_ROUTE_CROSSING_POSITIONS(route)(CrossingId)) }))"
                        },
                        "activating" : ["skip", "IS_endChangeCrossing"]
                    },
                        {
                            "id": "IS_endChangeCrossing",
                            "execute": "IS_endChangeCrossing",
                            "after": "RailML3_IL_MOVABLE_CROSSING_TYPICAL_THROW_TIMES(CrossingId)",
                            "activating": ["IL_noteChangeSignalState", "IL_endRouteReservation"]
                        },
                {
                    "id": "IS_startChangeDerailer",
                    "chooseActivation": {
                        "IS_startChangeDerailer_Exec": "IF {DerailerId, train | train : RS_arrivedTrains & RS_trainFront(train) : dom(RailML3_IS_DERAILER_NOT_PASSABLE(DerailerId)) or #route.(route : dom(IL_routes_in_res) /\\ dom(RailML3_IL_ROUTE_DERAILERS) & DerailerId : RailML3_IL_ROUTE_DERAILERS(route) ) } /= {} THEN 1.0 ELSE 0.0 END",
                        "skip": "1.0 - IF {DerailerId, train | train : RS_arrivedTrains & RS_trainFront(train) : dom(RailML3_IS_DERAILER_NOT_PASSABLE(DerailerId)) or #route.(route : dom(IL_routes_in_res) /\\ dom(RailML3_IL_ROUTE_DERAILERS) & DerailerId : RailML3_IL_ROUTE_DERAILERS(route) ) } /= {} THEN 1.0 ELSE 0.0 END"
                    }
                },
                    {
                        "id": "IS_startChangeDerailer_Exec",
                        "execute": "IS_startChangeDerailer",
                        "after": 1000,
                        "fixedVariables":{
                            "DerailerId": "CHOOSE(dom({DerailerId, train | train : RS_arrivedTrains & RS_trainFront(train) : dom(RailML3_IS_DERAILER_NOT_PASSABLE(DerailerId)) or #route.(route : dom(IL_routes_in_res) /\\ dom(RailML3_IL_ROUTE_DERAILERS) & DerailerId : RailML3_IL_ROUTE_DERAILERS(route) ) }))"
                        },
                        "activating" : ["skip", "IS_endChangeDerailer"]
                    },
                        {
                            "id": "IS_endChangeDerailer",
                            "execute": "IS_endChangeDerailer",
                            "after": "RailML3_IL_DERAILER_TYPICAL_THROW_TIMES(DerailerId)",
                            "activating": ["IL_noteChangeSignalState", "IL_endRouteReservation"]
                        },
                    
                {
                    "id": "IS_startChangeSwitch",
                    "chooseActivation": {
                        "IS_startChangeSwitch_Exec": "IF {SwitchId, train | train : RS_arrivedTrains & RS_trainFront(train) : dom(RailML3_IS_SWITCH_BRANCHES(SwitchId)) or #route.(route : dom(IL_routes_in_res) /\\ dom(RailML3_IL_ROUTE_SWITCH_POSITIONS) & SwitchId : dom(RailML3_IL_ROUTE_SWITCH_POSITIONS(route)) & IS_switch_states(SwitchId) /= RailML3_IL_ROUTE_SWITCH_POSITIONS(route)(SwitchId) ) } /= {} THEN 1.0 ELSE 0.0 END",
                        "skip": "1.0 - IF {SwitchId, train | train : RS_arrivedTrains & RS_trainFront(train) : dom(RailML3_IS_SWITCH_BRANCHES(SwitchId)) or #route.(route : dom(IL_routes_in_res) /\\ dom(RailML3_IL_ROUTE_SWITCH_POSITIONS) & SwitchId : dom(RailML3_IL_ROUTE_SWITCH_POSITIONS(route)) & IS_switch_states(SwitchId) /= RailML3_IL_ROUTE_SWITCH_POSITIONS(route)(SwitchId) ) } /= {} THEN 1.0 ELSE 0.0 END"
                    }
                },
                    {
                        "id": "IS_startChangeSwitch_Exec",
                        "execute": "IS_startChangeSwitch",
                        "after": 1000,
                        "additionalGuards": "{SwitchId, train | train : RS_arrivedTrains & RS_trainFront(train) : dom(RailML3_IS_SWITCH_BRANCHES(SwitchId)) or #route.(route : dom(IL_routes_in_res) /\\ dom(RailML3_IL_ROUTE_SWITCH_POSITIONS) & SwitchId : dom(RailML3_IL_ROUTE_SWITCH_POSITIONS(route)) & IS_switch_states(SwitchId) /= RailML3_IL_ROUTE_SWITCH_POSITIONS(route)(SwitchId) ) } /= {}",
                        "fixedVariables":{
                            "SwitchId": "CHOOSE(dom({SwitchId, train | train : RS_arrivedTrains & RS_trainFront(train) : dom(RailML3_IS_SWITCH_BRANCHES(SwitchId)) or #route.(route : dom(IL_routes_in_res) /\\ dom(RailML3_IL_ROUTE_SWITCH_POSITIONS) & SwitchId : dom(RailML3_IL_ROUTE_SWITCH_POSITIONS(route)) & IS_switch_states(SwitchId) /= RailML3_IL_ROUTE_SWITCH_POSITIONS(route)(SwitchId) ) }))"
                        },
                        "activating" : ["skip", "IS_endChangeSwitch"]
                    },
                        {
                            "id": "IS_endChangeSwitch",
                            "execute": "IS_endChangeSwitch",
                            "after": "RailML3_IL_SWITCH_TYPICAL_THROW_TIMES(SwitchId)",
                            "activating" : ["IS_endChangeSwitch", "IL_noteChangeSignalState", "IL_endRouteReservation"]
                        },

            {
                "id": "IL_Action",
                "chooseActivation": {
                    "IL_startRouteReservation_Choose": 0.34,
                    "IL_startActivateSignalplan_Choose": 0.33,
                    "IL_changeSignalState": 0.33
                }
            },
                {
                    "id": "IL_startRouteReservation_Choose",
                    "chooseActivation":{
                        "IL_startRouteReservation": "IF ENABLED(\"IL_startRouteReservation\") = TRUE THEN 1.0 ELSE 0.0 END",
                        "skip": "1.0 - IF ENABLED(\"IL_startRouteReservation\") = TRUE THEN 1.0 ELSE 0.0 END"
                    }
                },
                    {
                        "id": "IL_startRouteReservation",
                        "execute": "IL_startRouteReservation",
                        "after": 1000,
                        "activating" : ["IS_Action", "IL_startActivateSignalplan_Choose", "IL_endRouteReservation"]
                    },
                {
                    "id": "IL_startActivateSignalplan_Choose",
                    "chooseActivation":{
                        "IL_startActivateSignalplan": "IF ENABLED(\"IL_startActivateSignalplan\") = TRUE THEN 1.0 ELSE 0.0 END",
                        "skip": "1.0 - IF ENABLED(\"IL_startActivateSignalplan\") = TRUE THEN 1.0 ELSE 0.0 END"
                    }
                },
                    {
                        "id": "IL_startActivateSignalplan",
                        "execute": "IL_startActivateSignalplan",
                        "after": 1000,
                        "activating" : ["skip", "IL_noteChangeSignalState"]
                    },
                        {
                            "id": "IL_noteChangeSignalState",
                            "execute": "IL_noteChangeSignalState",
                            "after": 1000,
                            "additionalGuards": "{SignalId, sp | sp : IL_signalplan_in_activation & SignalId : RailML3_IL_SIGNAL_REFERS_TO[dom(sp'master \\/ sp'slave \\/ sp'distant)] - dom(IL_noted_signal_states) & ENABLED_TRANSITION(FORMAT_TO_STRING(\"IL_noteChangeSignalState(\\\"~w\\\")\", [SignalId])) = TRUE } /= {}",
                            "fixedVariables":{
                                "SignalId": "CHOOSE(dom({SignalId, sp | sp : IL_signalplan_in_activation & SignalId : RailML3_IL_SIGNAL_REFERS_TO[dom(sp'master \\/ sp'slave \\/ sp'distant)] - dom(IL_noted_signal_states) & ENABLED_TRANSITION(FORMAT_TO_STRING(\"IL_noteChangeSignalState(\\\"~w\\\")\", [SignalId])) = TRUE }))"
                            },
                            "activating" : ["IL_startRouteReservation", "IS_Action", "IL_noteChangeSignalState", "IL_endRouteReservation", "IL_endActivateSignalplan"]
                        },
                    {
                        "id": "IL_endRouteReservation",
                        "execute": "IL_endRouteReservation",
                        "after": 1000,
                        "activating" : ["IL_endActivateSignalplan", "IL_trainAcceptArrival_Exec"]
                    },
                    {
                        "id": "IL_endActivateSignalplan",
                        "execute": "IL_endActivateSignalplan",
                        "after": 1000
                    },
                {
                    "id": "IL_changeSignalState",
                    "chooseActivation": {
                        "IL_changeSignalState_Exec": "IF {SignalId, train | train : RS_arrivedTrains & SignalId : { i_sig | i_sig : allIdsOfType(\"signalIS\") & RS_trainFront(train) : RailML3_IS_SPOT_LOCATIONS(i_sig) } \\/ (IL_signal_locked - dom(IL_noted_signal_states)) } /= {} THEN 1.0 ELSE 0.0 END",
                        "skip": "1.0 - IF {SignalId, train | train : RS_arrivedTrains & SignalId : { i_sig | i_sig : allIdsOfType(\"signalIS\") & RS_trainFront(train) : RailML3_IS_SPOT_LOCATIONS(i_sig) } \\/ (IL_signal_locked - dom(IL_noted_signal_states)) } /= {} THEN 1.0 ELSE 0.0 END"
                    }
                },
                    {
                        "id": "IL_changeSignalState_Exec",
                        "execute": "IL_changeSignalState",
                        "after": 1000,
                        "additionalGuards": "{SignalId, train | train : RS_arrivedTrains & SignalId : { i_sig | i_sig : allIdsOfType(\"signalIS\") & RS_trainFront(train) : RailML3_IS_SPOT_LOCATIONS(i_sig) } \\/ (IL_signal_locked - dom(IL_noted_signal_states)) } /= {}",
                        "fixedVariables":{
                            "SignalId": "CHOOSE(dom({SignalId, train | train : RS_arrivedTrains & SignalId : { i_sig | i_sig : allIdsOfType(\"signalIS\") & RS_trainFront(train) : RailML3_IS_SPOT_LOCATIONS(i_sig) } \\/ (IL_signal_locked - dom(IL_noted_signal_states)) }))"
                        },
                        "activating": ["skip"],
                        "activationKind " : "single"
                    },
        {
            "id": "IL_partialRouteReleaseAhead",
            "execute": "IL_partialRouteReleaseAhead",
            "after": 1000,
            "activating" : ["IL_completeRouteRelease", "TrainArrive", "TrainMove_Init", "IS_startChangeSwitch", "IL_startRouteReservation", "IL_partialRouteReleaseAhead", "IL_partialRouteReleaseRear"]
        },
        {
            "id": "IL_partialRouteReleaseRear",
            "execute": "IL_partialRouteReleaseRear",
            "after": 1000,
            "activating" : ["IL_completeRouteRelease", "TrainArrive", "TrainMove_Init", "IS_startChangeSwitch", "IL_startRouteReservation", "IL_partialRouteReleaseAhead", "IL_partialRouteReleaseRear"]
        },
        {
            "id": "IL_completeRouteReleaseRear",
            "execute": "IL_completeRouteReleaseRear",
            "after": 1000,
            "activating" : ["TrainArrive", "TrainMove_Init", "IS_startChangeSwitch", "IL_startRouteReservation", "IL_partialRouteReleaseAhead", "IL_partialRouteReleaseRear", "IL_completeRouteRelease", "IL_noteChangeSignalState"]
        },
        {
            "id": "skip",
            "execute": "skip",
            "after": 1000,
            "activating": "Any_Action"
        }
    ],
    "listeners" : [
        {
            "id": "IS_changeSwitch",
            "event": "IS_startChangeSwitch",
            "activating": ["IS_endChangeSwitch"]
        },
        {
            "id": "RS_moveTrain",
            "event": "RS_trainMoveFront",
            "activating": ["RS_trainMoveBack"]
        }
    ]
}