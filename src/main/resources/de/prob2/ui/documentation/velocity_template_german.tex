#macro( call $this )#set( $stfu = $this )#end
#* This template is written with Apache Velocity Template Engine.
If you use text which has underscores u can use the latexSafe method of documentationUtility to escape them. *#
%Package and Style edits can be made in autodoc.cls%
\documentclass{latex_resources/autodoc}
\usepackage[ngerman]{babel}
\usepackage{datetime}
\newdateformat{myformat}{\THEDAY{ten }\monthname[\THEMONTH], \THEYEAR}
\begin{document}
%Titlepage%
\begin{titlepage}
	\begin{center}
	\includegraphics[width=0.50\textwidth]{latex_resources/ProB_Logo.png}\par\vspace{1cm}
	{\scshape\LARGE Automatisierte Dokumentation \par}
	\vspace{1cm}
	{\scshape\Large vom Projekt \par}
	\vspace{1.5cm}
	{\huge\bfseries $util.latexSafe($project.getName()) \par}
	\vspace{2cm}
	\vfill
	{\large \today\par}
	\end{center}
\end{titlepage}

\section{Einleitung}
Dies ist eine automatisch erstellte Dokumentation des ProB2-UI-Projekts: $util.latexSafe($project.getName()).
Das $util.latexSafe($project.getName())-Projekt besteht aus $project.getMachines().size() Maschinen, von
denen $machines.size() für die Dokumentation ausgewählt wurden.\\
#if(!$project.getDescription().isEmpty())
Die Projektbeschreibung lautet: $util.latexSafe($project.getDescription())
#end
#foreach($machine in $machines) ##LOOP OVER ALL MACHINES
%Unicodes in MCH Code can be added in autodoc.cls as Literate of MCH Style
\section{$util.latexSafe($machine.getName()) }
Die B-Maschine $util.latexSafe($machine.getName()) wird durch ihren Code definiert, der in Listing \ref{lst:code$foreach.index} gezeigt wird
\subsection{Code der B-Maschine $util.latexSafe($machine.getName()) }
\begin{lstlisting}[style=MCH, caption = $util.latexSafe($machine.getName()) MCH Code, label = lst:code$foreach.index]
$util.getMachineCode($machine,$project)
\end{lstlisting}

#if($modelchecking && !$machine.getModelcheckingItems().isEmpty())
\subsection{Model Checking}
	Die B-Maschine $util.latexSafe($machine.getName()) hat $util.getNumberSelectedTasks($machine.getModelcheckingItems()) Modelchecking Tasks,
	wovon $util.getNumberSuccessfulTasks($machine.getModelcheckingItems()) erfolgreich geprüft wurden, $util.getNumberFailedTasks($machine.getModelcheckingItems())
    fehlgeschlagen sind und $util.getNumberNotCheckedTasks($machine.getModelcheckingItems()) überhaupt nicht geprüft wurden.
	\tablestyle[sansbold]
	\begin{longtable}{*{2}{p{0.4\textwidth}}}
		\theadstart
			\thead Modelchecking Task &
			\thead Modelchecking Ergebnis\\
		\endfirsthead
		\tsubheadstart
			\thead Modelchecking Task &
			\thead Modelchecking Ergebnis\\
		\endhead
			\rowcolor{white}\caption{Modelchecking Tasks und Ergebnisse}\\
		\endlastfoot
		\tbody
		#foreach($item in $machine.getModelcheckingItems())
			#if($item.selected())
				#if($item.getItems().isEmpty())
			$util.modelcheckingToUIString($item,$i18n) & $i18n.translate("verifications.result.notChecked.header")\\
				#else
			$util.modelcheckingToUIString($item,$i18n) & #foreach($result in $item.getItems()) $result.getMessage() #end \\
				#end
			#end
		#end
		\tend
	\end{longtable}
#end

#if($ltl)
#if(!$machine.getLTLFormulas().isEmpty() || !$machine.getLTLPatterns().isEmpty() )
\subsection{LTL Model Checking}
#end
#if(!$machine.getLTLFormulas().isEmpty())
	Die B-Maschine $util.latexSafe($machine.getName()) verfügt über $util.getNumberSelectedTasks($machine.getLTLFormulas()) LTL-Formeln,
	von denen $util.getNumberSuccessfulTasks($machine.getLTLFormulas()) erfolgreich überprüft wurden, $util.getNumberFailedTasks($machine.getLTLFormulas())
	scheiterten und $util.getNumberNotCheckedTasks($machine.getLTLFormulas()) wurden überhaupt nicht überprüft.
	\tablestyle[sansbold]
	\begingroup
	\setlength{\LTleft}{-\textwidth plus -1fill}
	\setlength{\LTright}{\LTleft}
 	#* checks if descriptions exist so that extra column can be generated *#
	#set($createDescriptionColumn = $util.ltlDescriptionColumnNecessary($machine.getLTLFormulas()))
	\begin{longtable}{p{0.5\textwidth} #if($createDescriptionColumn) p{0.25\textwidth}p{0.25\textwidth} #else p{0.4\textwidth} #end}
		\theadstart
			\thead LTL Formel &
			#if($createDescriptionColumn) \thead Beschreibung & #end
			\thead Status\\
		\endfirsthead
		\tsubheadstart
			\thead LTL Formel &
			#if($createDescriptionColumn) \thead Beschreibung &  #end
			\thead Status\\
		\endhead
			\rowcolor{white}\caption{LTL Formeln und Ergebnisse}\\
		\endlastfoot
		\tbody
		#foreach($formula in $machine.getLTLFormulas())
			#if($formula.selected())
\begin{tabularlstlisting}[linewidth=0.5\textwidth ]
$formula.getCode()
\end{tabularlstlisting} & #if($createDescriptionColumn) $formula.getDescription() & #end
				#if($util.formulaHasResult($formula))
				 $i18n.translate($formula.getResultItem().getHeaderBundleKey())\\
				#else
				 $i18n.translate("verifications.result.notChecked.header") \\
				#end
			#end
		#end
		\tend
	\end{longtable}
	\justifying
#end
#if(!$machine.getLTLPatterns().isEmpty())
	\tablestyle[sansbold]
	\begingroup
	\setlength{\LTleft}{-\textwidth plus -1fill}
	\setlength{\LTright}{\LTleft}
	\begin{longtable}{L{0.3\textwidth}p{0.3\textwidth}p{0.3\textwidth}}
		\theadstart
			\thead Pattern Name &
			\thead Code &
			\thead Ergebnis\\
		\endfirsthead
		\tsubheadstart
			\thead Pattern Name &
			\thead Code &
			\thead Ergebnis\\
		\endhead
			\rowcolor{white}\caption{LTL Patterns und Ergebnisse}\\
		\endlastfoot
		\tbody
		#*tabularlstlisting cannot be indented *#
			#foreach($pattern in $machine.getLTLPatterns())
$pattern.getName() &
\begin{tabularlstlisting}[linewidth=0.29\textwidth]
$pattern.getCode()
\end{tabularlstlisting} &
			 #if($util.patternHasResult($pattern))
				$i18n.translate($pattern.getResultItem().getHeaderBundleKey()) \\
			#else
				$i18n.translate("verifications.result.notChecked.header")\\
			#end
		#end
		\tend
		\end{longtable}
	\justifying
#end
#end

#if($symbolic && !$machine.getSymbolicCheckingFormulas().isEmpty())
	%SYMBOLIC
	\subsection{Symbolic Model Checking}
	Die B Maschine $util.latexSafe($machine.getName()) hat $util.getNumberSelectedTasks($machine.getSymbolicCheckingFormulas()) Symbolic Model Checking Formeln, von denen $util.getNumberSuccessfulTasks($machine.getSymbolicCheckingFormulas()) erfolgreich überprüft wurden.
	$util.getNumberFailedTasks($machine.getSymbolicCheckingFormulas()) sind fehlgeschlagen und $util.getNumberNotCheckedTasks($machine.getSymbolicCheckingFormulas()) wurden überhaupt nicht überprüft.
	\tablestyle[sansbold]
		#* checks if descriptions exist so that extra column can be generated *#
		#set($createConfigurationColumn = $util.symbolicConfigurationColumnNecessary($machine.getSymbolicCheckingFormulas()))
		\begin{longtable}{p{0.3\textwidth}#if($createConfigurationColumn) p{0.4\textwidth} #end p{0.25\textwidth}}
		\theadstart
			\thead Symbolic Check &
			#if($createConfigurationColumn) \thead Konfiguration &  #end
			\thead Ergebnis\\
		\endfirsthead
		\tsubheadstart
			\thead Symbolic Check&
		#if($createConfigurationColumn) \thead Konfiguration &  #end
			\thead Ergebnis\\
		\endhead
			\rowcolor{white}\caption{Symbolic Formeln und Ergebnisse}\\
		\endlastfoot
		\tbody
		#foreach($sitem in $machine.getSymbolicCheckingFormulas())
			#if($sitem.selected())
				\seqsplit{$util.latexSafe($sitem.getType().toString())} & #if($createConfigurationColumn)  \seqsplit{$util.symbolicConfigString($sitem,$i18n)} & #end
				#if($util.symbolicHasResult($sitem))
					$i18n.translate($sitem.getResultItem().getHeaderBundleKey()) \\
				#else
					$i18n.translate("verifications.result.notChecked.header") \\
				#end
			#end
		#end
		\tend
		\end{longtable}
		\justifying
#end
#if(!$machine.getTraces().isEmpty())
	\subsection{Traces}
	Ein Trace bezieht sich auf eine Folge von Zustandsübergängen, Operationen und Ereignissen, die während der Ausführung eines Systems auftreten.
	Der Trace kann als Tabelle visualisiert werden, die die Operationen chronologisch auflistet, wobei die Spalte \glqq Schritt \grqq den Index der Reihenfolge
	angibt und die Spalte \glqq Transition \grqq den Namen der Operation. Dies kann nützlich sein, um das Verhalten des Systems zu verstehen und mögliche Fehler oder Probleme zu identifizieren.
	Traces sind Abfolgen von Operationen. Die B-Maschine $util.latexSafe($machine.getName()) verfügt über $machine.getTraces().size() Traces.
	Neben der Tabelle wird mittels VisB eine Visualisierung jedes Traces erstellt. Die Visualisierung bietet eine interaktive und visuelle Darstellung des Verhaltens des Systems während den Transitionen.
	#if($printHtmlCode)
		Der HTML-Quellcode für diese Visualisierungsdateien ist im Anhang zu finden
	#end
	#foreach($trace in $machine.getTraces())
		#call($trace.load())
		\tablestyle[sansbold]
		\begin{longtable}{c p{0.6\textwidth}}
		\rowcolor{white}\caption{$util.latexSafe($trace.getName())} \\
		\theadstart
			\thead Schritt &
			\thead Transition\\
		\endfirsthead
		\theadstart
			\thead Schritt &
			\thead Transition\\
		\endhead
		\tbody
		#foreach($transition in $trace.getLoadedTrace().getTransitionList())
			$foreach.index & \seqsplit{$util.transitionToUIString($transition)} \\
		#end
		\tend
		\end{longtable}
		#*each trace visualization is created and its path is saved in a hashmap with the name as the key.
		  This is so that the result can be referenced accordingly in the appendix.*#
		#call( $traceHtmlPaths.put($trace.getName(), $documenter.saveTraceHtml($machine,$trace)) )
		\IfFileExists{$traceHtmlPaths.get($trace.getName())}{
			Für die HTML Trace Visualisierung von $util.latexSafe($trace.getName()) \href{run:$traceHtmlPaths.get($trace.getName())}{[klicke hier!]}\\
		}{
		Die HTML Visualisierungsdateien ist nicht verfügbar.
		}
		#if($printHtmlCode)
			Für den HTML Quellcode \hyperref[lst:$trace.getName()]{[klicke hier!]}  \\
		#end
	#end
#end
#end
\justifying
#if(!$traceHtmlPaths.isEmpty() && $printHtmlCode) ## optional appendix which will print html source code of trace visualization
\appendix
\justifying
	\section{HTML Quellcode der Trace Visualisierungen}
Die Visualisierungen sind in Form von interaktiven HTML-Dateien. Wenn die HTML-Dateien nicht verfügbar sind, kann man die folgenden HTML-Quellcodes manuell kopieren.
	#foreach($pathEntry in $traceHtmlPaths.entrySet())
\begin{lstlisting}[label = lst:$pathEntry.key ,style = htmlAppendix, caption = $util.latexSafe($pathEntry.key) HTML Quellcode]
$util.getTraceHtmlCode($pathEntry.value,$documenter)
\end{lstlisting}
	#end
#end
\end{document}
