#macro( call $this )#set( $stfu = $this )#end
#* This template is written with Apache Velocity Template Engine.
If you use text which has underscores u can use the latexSafe method of documentationUtility to escape them. *#
%Package and Style edits can be made in autodoc.cls%
\documentclass{latex_resources/autodoc}
\begin{document}
%Titlepage%
\begin{titlepage}
	\begin{center}
	\includegraphics[width=0.50\textwidth]{latex_resources/ProB_Logo.png}\par\vspace{1cm}
	{\scshape\LARGE Automated Documentation \par}
	\vspace{1cm}
	{\scshape\Large of Project \par}
	\vspace{1.5cm}
	{\huge\bfseries $util.latexSafe($project.getName()) \par}
	\vspace{2cm}
	\vfill
	% Bottom of the page
	{\large \today\par}
	\end{center}
\end{titlepage}

\section{Introduction}
This is an automatically created documentation of the ProB2-UI project: $util.latexSafe($project.getName()).
The $util.latexSafe($project.getName()) project consists of  $project.getMachines().size() machines, $machines.size() of which were chosen for documentation.\\
#if(!$project.getDescription().isEmpty())
The Project Description is: $util.latexSafe($project.getDescription())
#end
#foreach($machine in $machines) ##LOOP OVER ALL MACHINES
%Unicodes in MCH Code can be added in autodoc.cls as Literate of MCH Style
\section{$util.latexSafe($machine.getName()) }
The B Machine $util.latexSafe($machine.getName()) is defined by its Code, shown in Listing \ref{lst:code$foreach.index}
\subsection{Code of B Machine $util.latexSafe($machine.getName()) }
\begin{lstlisting}[style=MCH, caption = $util.latexSafe($machine.getName()) MCH Code, label = lst:code$foreach.index]
$util.getMachineCode($machine,$project)
\end{lstlisting}

#if($modelchecking && !$machine.getModelcheckingItems().isEmpty())
\subsection{Model Checking}
	\begin{flushleft}
		The B Machine $util.latexSafe($machine.getName()) has $util.getNumberSelectedTasks($machine.getModelcheckingItems())  Modelchecking Tasks of which $util.getNumberSuccessfulTasks($machine.getModelcheckingItems()) were checked successfully
		$util.getNumberFailedTasks($machine.getModelcheckingItems()) failed and $util.getNumberNotCheckedTasks($machine.getModelcheckingItems()) were not checked at all.
	\end{flushleft}
	\tablestyle[sansbold]
	\begin{longtable}{*{2}{p{0.5\textwidth}}}
		\theadstart
			\thead Modelchecking Task &
			\thead Modelchecking Result\\
		\endfirsthead
		\tsubheadstart
			\thead Modelchecking Task &
			\thead Modelchecking Result\\
		\endhead
			\rowcolor{white}\caption{Modelchecking Tasks and Results}\\
		\endlastfoot
		\tbody
		#foreach($item in $machine.getModelcheckingItems())
			#if($item.selected())
				#if($item.getItems().isEmpty())
			$util.toUIString($item,$i18n) & $i18n.translate("verifications.result.notChecked.header")\\
				#else
			$util.toUIString($item,$i18n) & #foreach($result in $item.getItems()) $result.getMessage() #end \\
				#end
			#end
		#end
		\tend
	\end{longtable}
#end

#if($ltl)
#if(!$machine.getLTLFormulas().isEmpty() || !$machine.getLTLPatterns().isEmpty() )
\subsection{LTL Model Checking}
#end
#if(!$machine.getLTLFormulas().isEmpty())
	\begin{flushleft}
		The B Machine $util.latexSafe($machine.getName()) has $util.getNumberSelectedTasks($machine.getLTLFormulas()) LTL Formulas of which $util.getNumberSuccessfulTasks($machine.getLTLFormulas()) were checked successfully
		$util.getNumberFailedTasks($machine.getLTLFormulas()) failed and $util.getNumberNotCheckedTasks($machine.getLTLFormulas()) were not checked at all.
	\end{flushleft}
	\tablestyle[sansbold]
	\begingroup
	\setlength{\LTleft}{-\textwidth plus -1fill}
	\setlength{\LTright}{\LTleft}
 	#* checks if descriptions exist so that extra column can be generated *#
	#set($createDescriptionColumn = $util.ltlDescriptionColumnNecessary($machine.getLTLFormulas()))
	\begin{longtable}{p{0.5\textwidth} #if($createDescriptionColumn) p{0.25\textwidth}p{0.25\textwidth} #else p{0.4\textwidth} #end}
		\theadstart
			\thead LTL Formula &
			#if($createDescriptionColumn) \thead Description & #end
			\thead Status\\
		\endfirsthead
		\tsubheadstart
			\thead LTL Formula &
			#if($createDescriptionColumn) \thead Description &  #end
			\thead Status\\
		\endhead
			\rowcolor{white}\caption{LTL Formulas and Results}\\
		\endlastfoot
		\tbody
		#foreach($formula in $machine.getLTLFormulas())
			#if($formula.selected())
				#if($util.formulaHasResult($formula))
\begin{tabularlstlisting}[linewidth=0.5\textwidth ]
$formula.getCode()
\end{tabularlstlisting} & #if($createDescriptionColumn) $formula.getDescription() & #end $i18n.translate($formula.getResultItem().getHeaderBundleKey())\\
				#else
\begin{tabularlstlisting}[linewidth=0.5\textwidth ]
$formula.getCode()
\end{tabularlstlisting} & #if($createDescriptionColumn) $formula.getDescription() & #end $i18n.translate("verifications.result.notChecked.header") \\
				#end
			#end
		#end
		\tend
	\end{longtable}
	\justifying
#end
#if(!$machine.getLTLPatterns().isEmpty())
	\tablestyle[sansbold]
	\begingroup
	\setlength{\LTleft}{-\textwidth plus -1fill}
	\setlength{\LTright}{\LTleft}
	\begin{longtable}{L{0.3\textwidth}p{0.3\textwidth}p{0.3\textwidth}}
		\theadstart
			\thead Pattern Name &
			\thead Code &
			\thead Result\\
		\endfirsthead
		\tsubheadstart
			\thead Pattern Name &
			\thead Code &
			\thead Result\\
		\endhead
			\rowcolor{white}\caption{LTL Patterns and Results}\\
		\endlastfoot
		\tbody
		#*tabularlstlisting cannot be indented *#
		#foreach($pattern in $machine.getLTLPatterns())
			#if($util.patternHasResult($pattern))
$pattern.getName() &
\begin{tabularlstlisting}[linewidth=0.29\textwidth]
$pattern.getCode()
\end{tabularlstlisting} & $i18n.translate($pattern.getResultItem().getHeaderBundleKey()) \\
			#else
				$pattern.getName() &
\begin{tabularlstlisting}[linewidth=0.29\textwidth]
$pattern.getCode()
\end{tabularlstlisting} & $i18n.translate("verifications.result.notChecked.header")\\
			#end
		#end
		\tend
		\end{longtable}
	\justifying
#end
#end

#if($symbolic && !$machine.getSymbolicCheckingFormulas().isEmpty())
	%SYMBOLIC
	\subsection{Symbolic Model Checking}
	\begin{flushleft}
		The B Machine $util.latexSafe($machine.getName()) has $util.getNumberSelectedTasks($machine.getSymbolicCheckingFormulas()) Symbolic Model Checking Formulas of which $util.getNumberSuccessfulTasks($machine.getSymbolicCheckingFormulas()) were checked successfully
		$util.getNumberFailedTasks($machine.getSymbolicCheckingFormulas()) failed and $util.getNumberNotCheckedTasks($machine.getSymbolicCheckingFormulas()) were not checked at all.
	\end{flushleft}
	\tablestyle[sansbold]
		\begingroup
		\setlength{\LTleft}{-\textwidth plus -1fill}
		\setlength{\LTright}{\LTleft}
		#* checks if descriptions exist so that extra column can be generated *#
		#set($createConfigurationColumn = $util.symbolicConfigurationColumnNecessary($machine.getSymbolicCheckingFormulas()))
		\begin{longtable}{p{0.5\textwidth}#if($createConfigurationColumn) p{0.25\textwidth} #end p{0.25\textwidth}}
		\theadstart
			\thead Symbolic Check&
			#if($createConfigurationColumn) \thead Configuration &  #end
			\thead Result\\
		\endfirsthead
		\tsubheadstart
			\thead Symbolic Check&
		#if($createConfigurationColumn) \thead Configuration &  #end
			\thead Result\\
		\endhead
			\rowcolor{white}\caption{Symbolic Formulars and Results}\\
		\endlastfoot
		\tbody
		#foreach($sitem in $machine.getSymbolicCheckingFormulas())
			#if($sitem.selected())
				#if($util.symbolicHasResult($sitem))
					$util.latexSafe($sitem.getType().toString()) & #if($createConfigurationColumn) $util.latexSafe($sitem.getCode()) & #end $i18n.translate($sitem.getResultItem().getHeaderBundleKey()) \\
				#else
					$util.latexSafe($sitem.getType().toString()) & #if($createConfigurationColumn) $util.latexSafe($sitem.getCode()) & #end $i18n.translate("verifications.result.notChecked.header") \\
				#end
			#end
		#end
		\tend
		\end{longtable}
		\endgroup
		\justifying
#end
#if(!$machine.getTraces().isEmpty())
	\subsection{Traces}
	\begin{flushleft}
		A Trace refers to a sequence of state transitions, operations, and events that occur during the execution of a system.
		The trace can be visualized as a table that lists the operations chronologically, with the position column indicating the index of the order, and the transition
		column indicating the name of the operation. This can be useful for understanding the behavior of the system and identifying any errors or issues that may be present.
		Traces are orders of operations. The B Machine $util.latexSafe($machine.getName()) has $machine.getTraces().size() Traces.
		In addition to the table, a visualization of every trace is generated via VisB. The visualization provides an interactive and visual
		representation of the system's behavior during the trace transitions.
		#if($printHtmlCode)
			The HTML code for these visualization files is also included in the appendix.
		#end
	\end{flushleft}
	#foreach($trace in $machine.getTraces())
		#call($trace.load())
		\tablestyle[sansbold]
		\begin{longtable}{p{0.1\textwidth}p{0.6\textwidth}}
		\rowcolor{white}\caption{$util.latexSafe($trace.getName())} \\
		\theadstart
			\thead Step &
			\thead Transition\\
		\endfirsthead
		\theadstart
			\thead Step &
			\thead Transition\\
		\endhead
		\tbody
		#foreach($transition in $trace.getLoadedTrace().getTransitionList())
			$foreach.index & $util.latexSafe($Transition.prettifyName($transition.getOperationName())) \\
		#end
		\tend
		\end{longtable}
		\justifying
		#*each trace visualization is created and its path is saved in a hashmap with the name as the key.
		  This is so that the result can be referenced accordingly in the appendix.*#
		#call( $traceHtmlPaths.put($trace.getName(), $documenter.saveTraceHtml($machine,$trace)) )
		\IfFileExists{$traceHtmlPaths.get($trace.getName())}{
			For the HTML Trace Visualization of $util.latexSafe($trace.getName()) \href{run:$traceHtmlPaths.get($trace.getName())}{[click here!]}\\
		}{
		The HTML file for the Trace Visualization isn't available.
		}
		#if($printHtmlCode)
			For the HTML Source Code \hyperref[lst:$trace.getName()]{[click here!]}  \\
		#end
	#end
#end
#end

#if(!$traceHtmlPaths.isEmpty() && $printHtmlCode) ## optional appendix which will print html source code of trace visualization
\appendix
\justifying
	\section{Traces Visualization HTML Code}
The visualizations are in the form of interactive HTML files. If the HTML Files are not available you can manually copy the following HTML source codesA .
	#foreach($pathEntry in $traceHtmlPaths.entrySet())
\begin{lstlisting}[label = lst:$pathEntry.key ,style = htmlAppendix, caption = $util.latexSafe($pathEntry.key) MCH Code]
$util.getTraceHtmlCode($pathEntry.value,$documenter)
\end{lstlisting}
	#end
#end
\end{document}
